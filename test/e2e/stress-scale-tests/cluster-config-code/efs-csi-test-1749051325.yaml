apiVersion: eksctl.io/v1alpha5
iam:
  serviceAccounts:
  - attachPolicyARNs:
    - arn:aws:iam::aws:policy/service-role/AmazonEFSCSIDriverPolicy
    metadata:
      name: efs-csi-controller-sa
      namespace: kube-system
  withOIDC: true
kind: ClusterConfig
metadata:
  name: efs-csi-test-1749051325
  region: us-west-2
  version: '1.33'
nodeGroups:
- desiredCapacity: 3
  iam:
    attachPolicy:
      Statement:
      - Action:
        - elasticfilesystem:DescribeAccessPoints
        - elasticfilesystem:DescribeFileSystems
        - elasticfilesystem:DescribeMountTargets
        - ec2:DescribeAvailabilityZones
        Effect: Allow
        Resource: '*'
      - Action:
        - elasticfilesystem:CreateAccessPoint
        Condition:
          StringLike:
            aws:RequestTag/kubernetes.io/cluster/*: owned
        Effect: Allow
        Resource: '*'
      - Action:
        - elasticfilesystem:DeleteAccessPoint
        Condition:
          StringEquals:
            aws:ResourceTag/kubernetes.io/cluster/*: owned
        Effect: Allow
        Resource: '*'
      Version: '2012-10-17'
  instanceType: t3.large
  labels:
    efs-issue: 'true'
    role: general
  maxSize: 5
  minSize: 2
  name: ng-1
  tags:
    nodegroup-role: general
  volumeSize: 80
